---
title: 记一道题
date: 2019-03-25 22:10:31
tags:
    - 学习笔记
---
#### 题目

```
- 下面代码中 a 在什么情况下会打印 1 ?
var a = ?;
if (a == 1 && a == 2 && a == 3) {
  console.log(1);
}
```

同事老哥分享在群里的一道题目,题目来源于[此处](https://github.com/Advanced-Frontend/Daily-Interview-Question/blob/master/datum/summary.md#%E7%AC%AC-38-%E9%A2%98%E4%B8%8B%E9%9D%A2%E4%BB%A3%E7%A0%81%E4%B8%AD-a-%E5%9C%A8%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E6%89%93%E5%8D%B0-1)

我看到题目二话没说来了一句` var a = (function() {console.log(1)})();`,直接把老哥们皮出了一阵省略号...

其实这题考察的应该是`==`的隐式转换, 当引用类型在比较运算符时,隐式转换会调用本类型toString或valueOf方法.

#### 重写toString

```
var a = {
  num: 1,
  toString() {
  	return this.num++;
  }
};

if (a == 1 && a == 2 && a == 3) {
  console.log(1);
}

=> 1
```

#### 重写valueOf

```
var a = {
  num: 1,
  valueOf() {
  	return this.num++;
  }
};

if (a == 1 && a == 2 && a == 3) {
  console.log(1);
}

=> 1
```

总体思路就是当 a 获取一次值的时候返回值+1, 让其符合 if 条件语句从而打印 a

那么我们还可以通过`defineProperty`重写对象的get方法实现

#### defineProperty

```
var num = 1;
Object.defineProperty(window, 'a', { get: function() { return num++ } });

if (a == 1 && a == 2 && a == 3) {
  console.log(1);
}

=> 1
```

我们除了通过`defineProperty`实现之外还可以通过`Proxy`实现, 这也正是Vue2.0和3.0数据绑定实现的区别

#### Proxy

```
// todo
```
#### 秀儿

除了以上答案等实现方法外,还有个方法实现得很秀

````
let a = [1,2,3];
a.join = a.shift;

if( a == 1 && a == 2 && a == 3 ) {
console.log(1);
}

=> 1
````

a 赋值为数组`[1,2,3]`,然后将`Array.shift`方法重写`Array.join` 方法

```
shift() 方法用于把数组的第一个元素从其中删除，并返回第一个元素的值。
join() 方法用于把数组中的所有元素放入一个字符串。
```

讲道理, 不是应该重写`Array.toString`方法,我将`a.join = a.shift;`改成`a.toString = a.shift;`运行

果然, 控制台打印了1.

后来上谷歌查询ECMA规范[22.1.3.27处](https://www.ecma-international.org/ecma-262/6.0/#sec-array.prototype.tostring) , `Array.toString`方法果然是调用`Array.join`方法

```
22.1.3.27 Array.prototype.toString ( )
When the toString method is called, the following steps are taken:

1. Let array be ToObject(this value).
2. ReturnIfAbrupt(array).
3. Let func be Get(array, "join").
4. ReturnIfAbrupt(func).
5. If IsCallable(func) is false, let func be the intrinsic function %ObjProto_toString% (19.1.3.6).
6. Return Call(func, array).

NOTE 
	The toString function is intentionally generic; it does not require that its this value be 	an Array object. Therefore it can be transferred to other kinds of objects for use as a method.
```

学习了, 给出这个答案的人真的非常厉害 ! ! !

#### 总结

 一个人知识面就像是一个圆, 这个圆的边界即是你所未知的. 当你知道得越多的同时, 你所不知道的也就越多.

路漫漫其修远兮, 吾将上下而求索.